<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hello World</title>
    <!-- <link rel="stylesheet" href="css/app.css"> -->
</head>
<body>
    <script src="js/pixi.min.js"></script>
	<!-- <script src="js/scaleToWindow.js"></script> -->
	<script type="text/javascript">
		//Aliases
	    let Application = PIXI.Application,
	    	Container = PIXI.Container,
	    	loader = PIXI.loader,
	    	resources = PIXI.loader.resources,
	    	TextureCache = PIXI.utils.TextureCache,
	    	Sprite = PIXI.Sprite,
	    	Rectangle = PIXI.Rectangle,
	    	ParticleContainer = PIXI.particles.ParticleContainer,
	    	Graphics = PIXI.Graphics,
	    	Text = PIXI.Text,
	    	TextStyle = PIXI.TextStyle;

	    //Create a Pixi Application
	    let app = new Application({
	    	width: 512,         		// default: 800
		    height: 512,        		// default: 600
		    antialias: true,    		// default: false
		    transparent: false, 		// default: false
		    resolution: 1,      		// default: 1
	    });

	    //Add the canvas that Pixi automatically created for you to the HTML document
		document.body.appendChild(app.view);

	    //Make the canvas fill the entire window
	    // app.renderer.view.style.position = 'absolute';
	    // app.renderer.view.style.display = 'block';
	    // app.renderer.autoResize = true;
	    // app.renderer.resize(window.innerWidth, window.innerHeight);

	    //Auto resize the canvas every time the size of the browser window is changed
	    // window.addEventListener('resize', function(event){
	    // 	scaleToWindow(app.view);
	    // });

	    //load a JSON file and run the `setup` function when it's done
	    loader
	    	.add('img/treasureHunter.json')
	    	.on('progress', loadProgressHandler)
	    	.load(setup);

	    function loadProgressHandler(loader, resources)
	    {
	    	//Display the file 'url' currently being loaded
	    	console.log('loading: ' + resources.url + ' ' + loader.progress + '%');
	    }

	    //Define variables that might be used in more than one function
	    let dungeon, explorer, treasure, door, id, state;

	    //This `setup` function will run when the image has loaded
	    function setup()
	    {
	    	console.log('All files loaded!');

	    	//Capture the keyboard arrow keys
			let left = keyboard(37),
				up = keyboard(38),
				right = keyboard(39),
				down = keyboard(40);

			//Left arrow key `press` method
			left.press = () => {
				//Change the explorer's velocity when the key is pressed
				explorer.vx = -1;
				explorer.vy = 0;
			}

			//Left arrow key `release` method
			left.release = () => {
				//If the left arrow has been released, and the right arrow isn't down, and the explorer isn't moving vertically: Stop the explorer
				if (!right.isDown && explorer.vy === 0)
				{
					explorer.vx = 0;
				}
			}

			//Up arrow key `press` method
			up.press = () => {
				explorer.vx = 0;
				explorer.vy = -1;
			}

			//Up arrow key `release` method
			up.release = () => {
				if (!down.isDown && explorer.vx === 0)
				{
					explorer.vy = 0;
				}
			}

			//Right arrow key `press` method
			right.press = () => {
				explorer.vx = 1;
				explorer.vy = 0;
			}

			//Right arrow key `release` method
			right.release = () => {
				if (!left.isDown && explorer.vy === 0)
				{
					explorer.vx = 0;
				}
			}

			//Down arrow key `press` method
			down.press = () => {
				explorer.vx = 0;
				explorer.vy = 1;
			}

			//Down arrow key `release` method
			down.release = () => {
				if (!up.isDown && explorer.vx === 0)
				{
					explorer.vy = 0;
				}
			}

	    	//Create an optional alias called `id` for all the texture atlas frame id textures
			id = resources["img/treasureHunter.json"].textures;

			//Dungeon
			dungeon = new Sprite(id['dungeon.png']);
			app.stage.addChild(dungeon);

			//Explorer
			explorer = new Sprite(id['explorer.png']);
			explorer.position.set(68, 68);
			explorer.vx = 0;
			explorer.vy = 0;
			app.stage.addChild(explorer);

			//Treasure box
			treasure = new Sprite(id['treasure.png']);
			treasure.position.set(app.stage.width - treasure.width - 48, app.stage.height / 2 - treasure.height / 2);
			app.stage.addChild(treasure);

			//Make the exit door
			door = new Sprite(id['door.png']);
			door.position.set(32, 0);
			app.stage.addChild(door);

			//Make the blobs
			let numberOfBlobs = 6,
				spacing = 48,
				xOffset = 150;

			//Make as many blobs as there are `numberOfBlobs`
			for (let i = 0; i < numberOfBlobs; i++)
			{
				//Make a blob
				let blob = new Sprite(id['blob.png']);

				//Space each blob horizontally according to the `spacing` value.
				//`xOffset` determines the point from the left of the screen at which the first blob should be added.
				let x = spacing * i + xOffset;

				//Give the blob a random y position
				//(`randomInt` is a custom function - see below)
				let y = randomInt(0, app.stage.height - blob.height);

				//Set the blob's position
				// blob.x = x;
				// blob.y = y;
				blob.position.set(x, y);

				//Add the blob sprite to the stage
				app.stage.addChild(blob);
			}

			//Set the game state
  			state = play;

  			//Start the game loop 
			app.ticker.add(delta => gameLoop(delta));

			//Drawing shape
			// let shape = new Graphics();
			// shape.lineStyle(2, 0xFF3300, 1);
			// shape.beginFill(0x66CCFF);

			// //Rectangle
			// // shape.drawRect(0, 0, 64, 64);

			// //Circle
			// // shape.drawCircle(0, 0, 64, 64);

			// //Ellips
			// // shape.drawEllipse(0, 0, 64, 24);

			// //Round rectangle
			// shape.drawRoundedRect(0, 0, 64, 64);

			// //Line
			// // shape.moveTo(0, 0);
			// // shape.lineTo(80, 40);

			// shape.endFill();
			// shape.position.set(170, 170);
			// app.stage.addChild(shape);

			//Drawing rectangle
			// let triangle = new Graphics();
			// triangle.beginFill(0x66FF33);
			// triangle.drawPolygon([
			// 	-32, 64,	//First point 	point1X, point1Y,
			// 	32, 64,		//Second point 	point2X, point2Y,
			// 	0, 0		//Third point 	point3X, point3Y
			// ]);
			// triangle.endFill();
			// triangle.position.set(180, 30);
			// app.stage.addChild(triangle);

			//Displaying text
			let styles = new TextStyle({
				fontFamily: 'Arial',
				fontSize: 26,
				fill: 'white',
				stroke: '#ff3300',
				strokeThickness: 4,
				dropShadow: true,
				dropShadowColor: '#000000',
				dropShadowBlur: 4,
				dropShadowAngle: Math.PI / 6,
				dropShadowDistance: 6,
			});

			let styledMessage = new Text('Hello World!', styles);
			styledMessage.position.set(app.stage.width / 2 - styledMessage.width / 2, 50);
			app.stage.addChild(styledMessage);
	    }

	    //The `randomInt` helper function
		function randomInt(min, max)
		{
			return Math.floor(Math.random() * (max - min + 1)) + min;
		}

		function gameLoop(delta)
		{
			//Update the current game state:
			state(delta);
		}

		function play(delta)
		{
			//Use the explorer's velocity to make it move
			explorer.x += explorer.vx;
			explorer.y += explorer.vy;
		}

		function keyboard(keyCode)
		{
			let key = {};
			key.code = keyCode;
			key.isDown = false;
			key.isUp = true;
			key.press = undefined;
			key.release = undefined;

			//The `downHandler`
			key.downHandler = event => {
				if (event.keyCode === key.code)
				{
					if (key.isUp && key.press) key.press();
					key.isDown = true;
					key.isUp = false;
				}
				event.preventDefault();
			};

			//The `upHandler`
			key.upHandler = event => {
				if (event.keyCode === key.code)
				{
					if (key.isDown && key.release) key.release();
					key.isDown = false;
					key.isUp = true;
				}
				event.preventDefault();
			}

			//Attach event listeners
			window.addEventListener (
				'keydown', key.downHandler.bind(key), false
			);
			window.addEventListener(
				'keyup', key.upHandler.bind(key), false
			);
			return key;
		}
	</script>
</body>
</html>